<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>3D Plotter</title>
		<style>
			body { margin: 0; }
			canvas { 
				border-style: solid;
				border-width: 2px;
				 }
			.equationInput{
				padding: 10px;
			}
		</style>
		<script src="parser.js"></script>
		<script src="math.min.js"></script>
	</head>
	<body>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r73/three.min.js"></script>
		<div class="equationInput">
			
			<label> <em>Z</em> = &nbsp;</label><input id="mathFuncInput" type="text" placeholder="Sin(x) + Cos(y)">
			<button onclick="evaluateInput();" > Ok! </button>
		</div>
		<script>
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 45, 1, 0.1, 1000 );
			camera.position.y = 50;
			camera.position.x = 0;
			camera.position.z = 40;
			camera.rotation.x = -45* ( Math.PI / 180);  
			scene.add(camera)

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( 800, 450);
			renderer.setClearColor(0xffffff, 1); 
			document.body.appendChild( renderer.domElement );

			var planeMaterial = new THREE.MeshLambertMaterial({
			      color: 0xffffff,
			      wireframe: true,
			});

			var pointLight = new THREE.PointLight(0xFFFFFF);

			// set its position
			pointLight.position.x = 0;
			pointLight.position.y = 0;
			pointLight.position.z = 150;

			scene.add(pointLight);

			var planeGeometry = new THREE.PlaneGeometry(40,40,30,30);
			planeGeometry.dynamic = true;
			planeGeometry.rotateX(90 * (Math.PI / 180));
			var planeMesh = new THREE.Mesh(planeGeometry, planeMaterial);

			for (var i = planeGeometry.vertices.length - 1; i >= 0; i--) {
				var x = planeGeometry.vertices[i].x;
				var z = planeGeometry.vertices[i].z;
				var y = Math.sin(x) + Math.cos(z);
				planeGeometry.vertices[i].setY(y);
			};

			scene.add(planeMesh);

			function render() {
				requestAnimationFrame( render );
				planeGeometry.rotateY(0.5/180);
				renderer.render( scene, camera );
			}
			render();

			function evaluateInput(){
				var mathExpression = mathFuncInput.value;
				//var parsedExpression = Parser.parse(mathExpression);
				var node = math.parse(mathExpression);
				node = node.compile();
				for (var i = planeGeometry.vertices.length - 1; i >= 0; i--) {
					var scope = {x: planeGeometry.vertices[i].x, y: planeGeometry.vertices[i].z};
					var _y = (math.eval(mathExpression, scope));
					//console.log(_y);
					planeGeometry.vertices[i].y = -node.eval(scope) ;
				};
				planeGeometry.verticesNeedUpdate = true;
			}
		</script>
	</body>
</html>